{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "nixpacks",
    "config": {
      "nixpacks": {
        "buildCommands": [
          "cp .env.production .env || true",
          "composer install --no-scripts --ignore-platform-reqs",
          "npm ci",
          "npm run build",
          "mkdir -p public/storage/app",
          "cp storage/app/taxonomy-r2-mapping.json public/storage/app/taxonomy-r2-mapping.json || echo 'Warning: R2 mapping not found'"
        ]
      }
    }
  },
  "plugins": [
    {
      "name": "mysql",
      "version": "8.0"
    },
    {
      "name": "redis",
      "version": "6"
    }
  ],
  "deploy": {
    "startCommand": "php artisan storage:link && php artisan migrate --force && php artisan db:seed --force && php artisan serve --host=0.0.0.0 --port=8080",
    "healthcheckPath": "/",
    "healthcheckTimeout": 100
  },
  "envs": [
    "APP_ENV=production",
    "APP_DEBUG=false",
    "DB_CONNECTION=mysql",
    "DB_HOST=localhost",
    "DB_PORT=3306",
    "DB_DATABASE=stock_r4e",
    "DB_USERNAME=root",
    "DB_PASSWORD=",
    "CACHE_DRIVER=redis",
    "QUEUE_CONNECTION=sync",
    "R2_ACCESS_KEY_ID=",
    "R2_SECRET_ACCESS_KEY=",
    "R2_BUCKET=stock-r4e-taxonomy",
    "R2_ENDPOINT=https://cd7a88507187155b85572a413ce5d288.r2.cloudflarestorage.com",
    "R2_PUBLIC_URL=https://pub-ab739e57f0754a92b660c450ab8b019e.r2.dev",
    "R2_REGION=auto"
  ]
}
